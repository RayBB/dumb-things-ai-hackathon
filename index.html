<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>SF Bay Fishtank</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
  *{margin:0;padding:0;overflow:hidden;}
  body{background:#000;}
  canvas{display:block;position:absolute;top:0;left:0;}
  #bg{z-index:1;}
  #fg{z-index:2;}
  #ui{
    position:absolute;top:20px;right:20px;z-index:10;
    color:#66ccff;font-family:Arial,Helvetica,sans-serif;
    pointer-events:auto;
  }
  #startAudio{
    position:fixed;top:50%;left:50%;
    --sway: 0;
    --bob: 0;
    transform: translate(calc(-50% + var(--sway)), calc(-50% + var(--bob))) rotate(0deg) scale(1);
    z-index:100;color:#ffffff;font-family:Arial,Helvetica,sans-serif;
    font-size:24px;padding:20px;border:2px solid #66ccff;
    background:rgb(0, 195, 255);border-radius:10px;cursor:pointer;
    pointer-events:auto;
  }

  @keyframes buttonChaos {
    0% { transform: translate(calc(-50% + var(--sway)), calc(-50% + var(--bob))) rotate(0deg) scale(1); box-shadow: 0 0 20px #66ccff; }
    25% { transform: translate(calc(-50% + var(--sway)), calc(-50% + var(--bob))) rotate(2deg) scale(1.05); box-shadow: 0 0 30px #44aaff; }
    50% { transform: translate(calc(-50% + var(--sway)), calc(-50% + var(--bob))) rotate(-2deg) scale(1); box-shadow: 0 0 25px #77ddff; }
    75% { transform: translate(calc(-50% + var(--sway)), calc(-50% + var(--bob))) rotate(1deg) scale(1.03); box-shadow: 0 0 35px #55bbff; }
    100% { transform: translate(calc(-50% + var(--sway)), calc(-50% + var(--bob))) rotate(0deg) scale(1.02); box-shadow: 0 0 20px #66ccff; }
  }

  #startAudio.animated {
    animation: buttonChaos 3s ease-in-out infinite;
  }

</style>
</head>
<body>

<canvas id="bg"></canvas>
<canvas id="fg"></canvas>

<div id="ui"></div>

<div id="startAudio">ðŸŒŠ Tap to Start ðŸŒ‰</div>

<audio src="sound/st.mp3" loop></audio>
<script src="https://unpkg.com/cursor-effects@latest/dist/browser.js"></script>

<script>
/* ---------- AUDIO ---------- */
const audio = document.querySelector('audio');
let audioStarted = false;

/* ---------- START AUDIO BUTTON ---------- */
const startAudioBtn = document.getElementById('startAudio');
startAudioBtn.addEventListener('click', () => {
  if (!audioStarted) {
    audio.volume = 0.15; // Set background audio to 75% volume
    audio.play().catch(err => {
      console.log('Audio play failed:', err);
    });
    audioStarted = true;
    startAudioBtn.style.display = 'none';
  }
});

/* ---------- CANVASES ---------- */
const bg = document.getElementById('bg'), bgCtx = bg.getContext('2d');
const fg = document.getElementById('fg'), fgCtx = fg.getContext('2d');

function resize(){
  bg.width = fg.width = window.innerWidth;
  bg.height = fg.height = window.innerHeight;
}
window.addEventListener('resize',resize); resize();

/* ---------- BACKGROUND (ocean) ---------- */
const particles=[],rays=[],jellies=[];
// more plankton for chaos
for(let i=0;i<300;i++) particles.push({x:Math.random()*bg.width,y:Math.random()*bg.height,
  vx:(Math.random()-0.5)*0.6,vy:Math.random()*0.8+0.3,r:Math.random()*2.5+1,a:Math.random()*0.8+0.4,
  sway:Math.random()*0.05+0.02});
// more rays
for(let i=0;i<12;i++) rays.push({x:Math.random()*bg.width,s:Math.random()*0.8+0.5});
// more jellies
for(let i=0;i<10;i++) jellies.push({x:Math.random()*bg.width,y:bg.height+120,
  r:Math.random()*90+60,s:Math.random()*0.7+0.4,p:Math.random()*0.03});

let t=0;
function drawBG(){
  t++; const w=bg.width,h=bg.height;

  // Animate the start audio button with chaotic ocean motion
  if (startAudioBtn && startAudioBtn.style.display !== 'none') {
    const buttonSway = Math.sin(t * 0.02) * 15; // horizontal sway
    const buttonBob = Math.sin(t * 0.03) * 10; // vertical bobbing
    startAudioBtn.style.setProperty('--sway', `${buttonSway}px`);
    startAudioBtn.style.setProperty('--bob', `${buttonBob}px`);
    if (!startAudioBtn.classList.contains('animated')) {
      startAudioBtn.classList.add('animated');
    }
  }

  // gradient - brighter blues
  const g=bgCtx.createLinearGradient(0,0,0,h);
  g.addColorStop(0,'#004466'); g.addColorStop(0.5,'#0099cc'); g.addColorStop(1,'#003355');
  bgCtx.fillStyle=g; bgCtx.fillRect(0,0,w,h);

  // light rays
  rays.forEach(r=>{ r.x-=r.s; if(r.x<-400) r.x=w+400;
    const gr=bgCtx.createLinearGradient(r.x,0,r.x+500,h);
    gr.addColorStop(0,'rgba(120,220,255,.2)'); gr.addColorStop(1,'rgba(80,160,255,0)');
    bgCtx.fillStyle=gr; bgCtx.beginPath();
    bgCtx.moveTo(r.x,0); bgCtx.lineTo(r.x+500,0);
    bgCtx.lineTo(r.x+350,h); bgCtx.lineTo(r.x-150,h);
    bgCtx.closePath(); bgCtx.fill();
  });

  // plankton - brighter blue with chaotic sway
  particles.forEach(p=>{ p.x+=p.vx + Math.sin(t*p.sway)*1.2; p.y+=p.vy;
    if(p.y>h){p.y=-20; p.x=Math.random()*w;}
    bgCtx.fillStyle=`rgba(100,220,255,${p.a})`;
    bgCtx.beginPath(); bgCtx.arc(p.x,p.y,p.r,0,Math.PI*2); bgCtx.fill();
  });

  // jellyfish - brighter blues
  jellies.forEach(j=>{ j.y-=j.s;
    if(j.y<-200){j.y=h+150; j.x=Math.random()*w;}
    const pulse=Math.sin(t*j.p)*0.4+1;
    const gj=bgCtx.createRadialGradient(j.x,j.y,0,j.x,j.y,j.r*pulse);
    gj.addColorStop(0,'rgba(100,230,255,.5)');
    gj.addColorStop(0.7,'rgba(80,200,255,.25)');
    gj.addColorStop(1,'rgba(50,140,255,0)');
    bgCtx.fillStyle=gj; bgCtx.beginPath();
    bgCtx.arc(j.x,j.y,j.r*pulse,0,Math.PI*2); bgCtx.fill();
  });

  requestAnimationFrame(drawBG);
}
drawBG();

/* ---------- TECH BRO QUOTES ---------- */
let quoteTimeout; // Store timeout ID to prevent multiple timers

// Audio management for quotes
let currentQuoteAudio = null; // Track currently playing quote audio

function stopQuoteAudio() {
  if (currentQuoteAudio) {
    currentQuoteAudio.pause();
    currentQuoteAudio.currentTime = 0;
    currentQuoteAudio = null;
  }
}

function playQuoteAudio(audioSrc) {
  // Stop any currently playing quote audio first
  stopQuoteAudio();

  // Create and play new quote audio
  currentQuoteAudio = new Audio(audioSrc);
  currentQuoteAudio.play().catch(err => {
    console.log('Quote audio play failed:', err);
  });

  return currentQuoteAudio;
}

const techBroQuotes = {
  fish: [
    { text: "The bay's getting cleaner, but the mercury levels in those bigger fish? Scary.", audioSrc: "voices/fish_1.wav" },
    { text: "Can fish actually live in the bay?", audioSrc: "voices/fish_2.wav" },
  ],
  pelican: [
    { text: "These birds divebomb like Silicon Valley jumping on trends - total commitment.", audioSrc: "voices/pelican_1.wav" },
    { text: "Pelican watching: nature's way of telling you to slow down for once.", audioSrc: "voices/pelican_2.wav" }
  ],
  muni: [
    { text: "Why am I always the one who gets stuck waiting while every other line runs perfect?", audioSrc: "voices/muni_1.wav" },
    { text: "Waited 45 minutes for the 22 Fillmore again. Might as well walk to Oakland at this point.", audioSrc: "voices/muni_2.wav" },
  ],
  waymo: [
    { text: "Waymos are stuck and are honking at each other during the night in San Francisco.", audioSrc: "voices/waymo_1.wav" },
    { text: "Lets just take a Waymo. My last Uber driver talked too much.", audioSrc: "voices/waymo_2.wav" },
  ],
  sealion: [
    { text: "Barking at tourists since 1990. World's most patient tour guides.", audioSrc: "voices/sealion_1.wav" },
    { text: "These sea lions have been holed up at Pier 39 for years - kinda our mascot now.", audioSrc: "voices/sealion_2.wav" },
  ],
  fog: [
    { text: "Fog's like the nice aunt who visits unannounced and wrecks your hair plans.", audioSrc: "voices/fog_1.wav" },
    { text: "Karl the Fog strikes again - this bastard loves ruining perfectly good sunsets.", audioSrc: "voices/fog_2.wav" },
    { text: "Fog's the one thing in SF that actually respects 'taking it slow'." }
  ],
  sourdough: [
    { text: "Sourdough is SF's gold - better than rush, but don't get carried away by prospectors.", audioSrc: "voices/sourdough_1.wav" },
    { text: "Tartine bread line is longer than the N Judah wait during a delay.", audioSrc: "voices/sourdough_2.wav" },
    { text: "Sourdough's the only thing that rises reliably in this city besides housing costs.", audioSrc: "voices/sourdough_3.wav" },
    { text: "My sourdough starter outlasted my last startup and two relationships.", audioSrc: "voices/sourdough_4.wav" }
  ],
  cablecar: [
    { text: "Tourists think it's cute. Locals think it's a daily lottery with physics.", audioSrc: "voices/cablecar_1.wav" },
    { text: "Cable car broke down again? Walk down Nob Hill - good cardio and same ETA.", audioSrc: "voices/cablecar_2.wav" },
    { text: "SF built these before were escalators. Shows what real innovation looked like.", audioSrc: "voices/cablecar_3.wav" },
  ],
  ai_billboard: [
    { text: "Billboards are a window into the soul of a city.", audioSrc: "voices/ai_billboard_1.wav" },
    { text: "Why does every billboard have to be an AI billboard?", audioSrc: "voices/ai_billboard_2.wav" },
  ],
  transamerica: [
    { text: "That pyramid's been the city's exclamation mark since I was knee-high to a fog bank.", audioSrc: "voices/transamerica_1.wav" },
    { text: "Height limit violator, architectural rebel. We love it for that.", audioSrc: "voices/transamerica_2.wav" }
  ],
  lacroix: [
    { text: "Dude, all the Pamplemousse ran out? This is a supply chain FAILURE!", audioSrc: "voices/lacroix_1.wav" },
    { text: "La Croix? I optimized my hydration with electrolyte-infused smart water instead.", audioSrc: "voices/lacroix_2.wav" },
    { text: "La Croix? Basic. I craft my own kombucha from biodynamic grapes in Napa.", audioSrc: "voices/lacroix_3.wav" },
    { text: "I invested in the startup making premium sparkling water pods last week.", audioSrc: "voices/lacroix_4.wav" },
  ],
  goldengate: [
    { text: "Crossing the bridge always feels like entering another world - especially in the fog.", audioSrc: "voices/goldengate_1.wav" },
    { text: "That bridge has stared down earthquakes, fog, and millions of tourist selfies.", audioSrc: "voices/goldengate_2.wav" },
    { text: "Golden Gate at sunset? Pure magic. Worth every penny of toll.", audioSrc: "voices/goldengate_3.wav" },
    { text: "They painted it orange so ships can see it through the fog. Smart thinking.", audioSrc: "voices/goldengate_4.wav" },
    { text: "Half the reason I moved here was to jog across that bridge at dawn.", audioSrc: "voices/goldengate_5.wav" },
    { text: "Bridge closes for high winds? Perfect excuse to re-read my stack of library books.", audioSrc: "voices/goldengate_6.wav" }
  ],
  clipper: [
    { text: "Getting seasick on the Larkspur? At least you're not on the 101 in rush hour.", audioSrc: "voices/clipper_1.wav" },
    { text: "Ferry terminal dog: better commute accessory than any coworking space.", audioSrc: "voices/clipper_2.wav" },
    { text: "Clipper card lost again? Third one this year. Dating myself with public transit woes.", audioSrc: "voices/clipper_3.wav" },
    { text: "Sausalito ferry at dusk - unbeatable commute if you time the tides right.", audioSrc: "voices/clipper_4.wav" },
    { text: "Golden Gate Ferry: because sometimes you need a break from the city's chaos.", audioSrc: "voices/clipper_5.wav" }
  ],
  coyote: [
    { text: "Coyote wandering up Delores at 3 AM. Welcome to SF living.", audioSrc: "voices/coyote_1.wav" },
    { text: "Coyotes searching through my compost bin at midnight. Sustainable living has consequences.", audioSrc: "voices/coyote_2.wav" },
    { text: "Coyotes in the backyard? Urban nature red in tooth and claw.", audioSrc: "voices/coyote_3.wav" }
  ],
  ia: [
    { text: "The internet archive preserves knowledge for future generations with open access.", audioSrc: "voices/ia_1.wav" },
    { text: "Timeless wisdom and human history safeguarded in digital eternity.", audioSrc: "voices/ia_2.wav" },
    { text: "Democratizing information through free archival preservation efforts.", audioSrc: "voices/ia_3.wav" },
    { text: "Bridging the past and future through dedicated knowledge stewardship.", audioSrc: "voices/ia_4.wav" }
  ],
  avocado: [
    { text: "Avocado toast for $15? It's actually not a bad deal for this city.", audioSrc: "voices/avocado_1.wav" },
    { text: "Avocados lack blockchain supply chain verification for fair trade credibility.", audioSrc: "voices/avocado_2.wav" },
  ],
};

/* ---------- VEHICLE SPAWNING ---------- */
function spawnInitialVehicles() {
  // Spawn initial vehicles for all vehicle types that should always spawn (spawnProb >= 1)
  vehicleTypes.forEach(type => {
    if (type.config.spawnProb >= 1) {
      for(let i = 0; i < type.config.count; i++){
        createVehicle(type);
      }
    }
  });
}

/* ---------- VEHICLE CONFIGS AND LOADING ---------- */
const vehicleConfigs = [
  { imgSrc: 'img/fish.png', w: 110, h: 70, speedMin: 1.2, speedMax: 3.0, count: 2, facingLeft: false, spawnProb: 0.03, name: 'fish' },
  { imgSrc: 'img/pelican.png', w: 110, h: 70, speedMin: 1.2, speedMax: 3.0, count: 5, facingLeft: true, spawnProb: 0.04, name: 'pelican' },
  { imgSrc: 'img/muni.png', w: 180, h: 120, speedMin: 0.6, speedMax: 1.4, count: 4, facingLeft: true, spawnProb: 0.025, name: 'muni' },
  { imgSrc: 'img/waymo.png', w: 200, h: 120, speedMin: 0.6, speedMax: 1.4, count: 3, facingLeft: true, spawnProb: 0.025, name: 'waymo' },
  { imgSrc: 'img/sealion.png', w: 90, h: 60, speedMin: 0.3, speedMax: 0.7, count: 1, facingLeft: false, spawnProb: 0.12, name: 'sealion' },
  { imgSrc: 'img/fog.png', w: 200, h: 140, speedMin: 0.3, speedMax: 0.7, count: 1, facingLeft: false, spawnProb: 0.1, name: 'fog' },
  { imgSrc: 'img/sourdough.png', w: 120, h: 120, speedMin: 0.5, speedMax: 0.9, count: 1, facingLeft: false, spawnProb: 0.02, name: 'sourdough' },
  { imgSrc: 'img/cable_car.png', w: 180, h: 120, speedMin: 0.5, speedMax: 1.3, count: 2, facingLeft: false, spawnProb: 0.025, name: 'cablecar' },
  { imgSrc: 'img/ai_billboard.png', w: 300, h: 180, speedMin: 0.2, speedMax: 0.5, count: 1, facingLeft: false, spawnProb: 0.05, name: 'ai_billboard' },
  { imgSrc: 'img/transamerica.png', w: 180, h: 300, speedMin: 0.1, speedMax: 0.2, count: 1, facingLeft: false, spawnProb: 0.02, name: 'transamerica' },
  { imgSrc: 'img/lacroix.png', w: 50, h: 80, speedMin: 0.6, speedMax: 1.4, count: 3, facingLeft: true, spawnProb: 0.04, name: 'lacroix' },
  { imgSrc: 'img/goldengate.png', w: 400, h: 200, speedMin: 0.05, speedMax: 0.1, count: 1, facingLeft: false, spawnProb: 0.03, name: 'goldengate' },
  { imgSrc: 'img/clipper.png', w: 180, h: 100, speedMin: 1.0, speedMax: 2.0, count: 2, facingLeft: false, spawnProb: 0.03, name: 'clipper' },
  { imgSrc: 'img/coyote.png', w: 100, h: 80, speedMin: 0.8, speedMax: 1.6, count: 1, facingLeft: true, spawnProb: 0.5, name: 'coyote' },
  { imgSrc: 'img/ia.png', w: 120, h: 80, speedMin: 0.8, speedMax: 1.6, count: 1, facingLeft: true, spawnProb: 0.5, name: 'ia' },
  { imgSrc: 'img/avocado.png', w: 90, h: 90, speedMin: 0.1, speedMax: 0.2, count: 3, facingLeft: true, spawnProb: 0.1, name: 'avocado' },
];

const vehicleTypes = [];
let loadedImages = 0;

function createVehicle(type) {
  const config = type.config;
  const fromLeft = Math.random() > 0.5;
  type.vehicles.push({
    x: fromLeft ? -300 : fg.width + 300,
    y: Math.random() * (fg.height * 0.7) + 100,
    vx: (fromLeft ? 1 : -1) * (Math.random() * (config.speedMax - config.speedMin) + config.speedMin),
    w: config.w, h: config.h,
    flip: config.facingLeft ? fromLeft : !fromLeft,
    bob: Math.random() * 0.04
  });
}

vehicleConfigs.forEach(config => {
  const img = new Image();
  img.src = config.imgSrc;
  const vehicles = [];
  img.onload = () => {
    tintBlue(img, () => {
      loadedImages++;
      if (loadedImages === vehicleConfigs.length) {
        // All images loaded, ensure drawFG is running if not started yet
        drawFG();
      }
    });
  };
  vehicleTypes.push({ img, vehicles, config });
});

// Start drawFG preemptively with first loaded (fish), but others will populate
if (vehicleTypes[0].img.complete) drawFG(); // But since onload starts it, ok

/* ---------- BUBBLES ---------- */
const bubbles=[];
// more bubbles for aquatic chaos
for(let i=0;i<60;i++){
  bubbles.push({
    x:Math.random()*fg.width,
    y:fg.height+Math.random()*150,
    r:Math.random()*6+4,
    s:Math.random()*2+1,
    sway:Math.random()*0.04
  });
}

/* ---------- FOREGROUND (fish + bubbles + quirk) ---------- */
function tintBlue(img, callback) {
  const canvas = document.createElement('canvas');
  canvas.width = img.naturalWidth;
  canvas.height = img.naturalHeight;
  const ctx = canvas.getContext('2d');
  ctx.drawImage(img, 0, 0);
  const imgData = ctx.getImageData(0, 0, canvas.width, canvas.height);
  const data = imgData.data;
  for (let i = 0; i < data.length; i += 4) {
    const r = data[i], g = data[i + 1], b = data[i + 2], a = data[i + 3];
    if (a > 0) {
      data[i] = Math.min(255, r * 0.8);
      data[i + 1] = Math.min(255, g * 0.8);
      data[i + 2] = Math.min(255, b * 1.2);
    }
  }
  ctx.putImageData(imgData, 0, 0);
  const originalSrc = img.src;
  img.src = canvas.toDataURL();
  img.onload = () => {
    if (callback) callback(img);
  };
}

function drawFG(){
  fgCtx.clearRect(0,0,fg.width,fg.height);
  t++;

  // ----- BUBBLES ----- brighter blue aquatic
  bubbles.forEach(b=>{
    b.y-=b.s; b.x+=Math.sin(t*b.sway)*0.8;
    if(b.y<-30){b.y=fg.height+30; b.x=Math.random()*fg.width;}
    fgCtx.fillStyle='rgba(180,240,255,.8)';
    fgCtx.beginPath(); fgCtx.arc(b.x,b.y,b.r,0,Math.PI*2); fgCtx.fill();
    fgCtx.fillStyle='rgba(220,255,255,.9)';
    fgCtx.beginPath(); fgCtx.arc(b.x-b.r*0.4,b.y-b.r*0.4,b.r*0.3,0,Math.PI*2); fgCtx.fill();
  });

  // ----- SPAWN VEHICLES ------
  // Only spawn vehicles after audio has started
  if (audioStarted) {
    vehicleTypes.forEach(type => {
      if (Math.random() < type.config.spawnProb && type.vehicles.length < type.config.count) {
        createVehicle(type);
      }
    });
  }

  // ----- VEHICLES -----
  vehicleTypes.forEach(type => {
    type.vehicles.forEach(v => {
      v.x += v.vx;
      v.y += Math.sin(t * v.bob) * 0.7;

      if (v.x < -350 || v.x > fg.width + 350) {
        v.vx *= -1;
        v.flip = !v.flip;
      }

      fgCtx.save();
      fgCtx.translate(v.x, v.y);
      if (v.flip) fgCtx.scale(-1, 1);
      fgCtx.drawImage(type.img, -v.w / 2, -v.h / 2, v.w, v.h);
      fgCtx.restore();
    });
  });

  requestAnimationFrame(drawFG);
}

// Click handling for sassy tech bro quotes
fg.addEventListener('click', (e) => {
  const rect = fg.getBoundingClientRect();
  const clickX = e.clientX - rect.left;
  const clickY = e.clientY - rect.top;

  // Check all vehicle types for clickable vehicles with quotes
  for (const vehicleType of vehicleTypes) {
    const config = vehicleType.config;
    const quotes = techBroQuotes[config.name];
    if (!quotes || quotes.length === 0) continue; // Skip if no quotes

    const clickedVehicle = vehicleType.vehicles.find(vehicle => {
      const left = vehicle.x - vehicle.w / 2;
      const right = vehicle.x + vehicle.w / 2;
      const top = vehicle.y - vehicle.h / 2;
      const bottom = vehicle.y + vehicle.h / 2;

      return clickX >= left && clickX <= right && clickY >= top && clickY <= bottom;
    });

    if (clickedVehicle) {
      // Show random quote from this vehicle's quote array
      const ui = document.getElementById('ui');
      const randomQuote = quotes[Math.floor(Math.random() * quotes.length)];
      ui.innerHTML = `<div style="background:rgba(0,0,0,0.8);padding:10px;border-radius:5px;max-width:250px;">"${randomQuote.text}"</div>`;
      ui.style.display = 'block';

      // Play audio if this quote has an associated audio file
      if (randomQuote.audioSrc) {
        playQuoteAudio(randomQuote.audioSrc);
      }

      // Clear any existing timeout and set new 5-second hide timer
      if (quoteTimeout) clearTimeout(quoteTimeout);
      quoteTimeout = setTimeout(() => {
        ui.style.display = 'none';
        // Stop audio when quote hides
        stopQuoteAudio();
      }, 5000);
      break; // Only show one quote per click
    }
  }
});

window.addEventListener("load", (event) => {
  console.log("Cursor effects loaded");
  new cursoreffects.fairyDustCursor({element: document.querySelector("#startAudio")});
});
</script>
</body>
</html>
